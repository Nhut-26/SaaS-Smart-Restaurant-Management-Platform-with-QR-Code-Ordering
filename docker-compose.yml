version: '3.8'

services:
  # ------------------------------------
  # 1. Backend AI (Sửa lại context)
  # ------------------------------------
  backend_ai:
    build:
      context: ./app/backend_ai     # <--- SỬA: Trỏ thẳng vào thư mục chứa code backend
      dockerfile: Dockerfile        # <--- Dockerfile nằm ngay trong thư mục đó
    container_name: s2o_backend_ai
    ports:
      - "8000:8000"
    environment:
      - PORT=8000
    env_file:
      - ./app/backend_ai/.env       # Đường dẫn file env giữ nguyên (tính từ root)
    networks:
      - s2o_network

  # ------------------------------------
  # 2. Web Guest (Sửa lại context)
  # ------------------------------------
  web_guest:
    build:
      context: ./Web_guest          # <--- SỬA: Trỏ thẳng vào thư mục Web_guest
      dockerfile: Dockerfile
    container_name: s2o_web_guest
    ports:
      - "5000:5000"
    environment:
      - PORT=5000
    env_file:
      - ./Web_guest/.env
    networks:
      - s2o_network

  # ------------------------------------
  # 3. Expo App (Giữ nguyên hoặc kiểm tra lại)
  # ------------------------------------
  expo_app:
    build:
      context: ./app                # <--- Đảm bảo trong folder 'app' có Dockerfile
      dockerfile: Dockerfile
    container_name: s2o_expo
    ports:
      - "8081:8081"
      - "19000-19006:19000-19006"
    environment:
      - CI=1
    volumes:
      - ./app:/app
      - /app/node_modules
    networks:
      - s2o_network

  # ------------------------------------
  # 4. Admin Web (Giữ nguyên)
  # ------------------------------------
  static_web:
    image: nginx:alpine
    container_name: s2o_static_web
    ports:
      - "8888:80"
    volumes:
      - ./:/usr/share/nginx/html
      - ./nginx.conf:/etc/nginx/nginx.conf
    networks:
      - s2o_network

networks:
  s2o_network:
    driver: bridge